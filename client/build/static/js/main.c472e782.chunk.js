(this.webpackJsonpninjabook=this.webpackJsonpninjabook||[]).push([[0],{34:function(e,t,a){e.exports=a(64)},39:function(e,t,a){},64:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(31),s=a.n(o),c=(a(39),a(8)),l=a(3),u=a(17),i=a(16),d=a(12),m=a.n(d),p=a(9),g=a.n(p),f="/api";h()&&(g.a.defaults.headers.common["x-auth-token"]=h());var b=h()?[]:[{title:"Please login to use",author:Date(),id:Date.now()}];function h(){return localStorage.getItem("token")}var v=function(){var e=Object(n.useState)(b),t=Object(l.a)(e,2),a=t[0],r=t[1];return[a,function(e){!function(e,t,a){var n=a.type,r=void 0===n?"":n,o=Object(i.a)(a,["type"]);if("initialize"===r);else if(h()){if("deleteBook"===r)return g.a.delete("".concat(f,"/booklist/deletebook/")+o.id).then((function(a){var n=e.filter((function(e){return e.id!==o.id}));t(n)})).catch((function(e){console.log(e.response.data),alert(e.response.data)}));if("logout"!==r)return"getBookList"===r?g.a.get("".concat(f,"/booklist/getbooklist")).then((function(e){var a=e.data.map((function(e){return{title:e.title,author:e.author,id:e.id}}));t(a)})).catch((function(e){console.log(e.response.data),alert(e.response.data)})):"addBook"===r?g.a.post("".concat(f,"/booklist/addbook"),o.book).then((function(a){t([].concat(Object(u.a)(e),[o.book]).sort((function(e,t){return e.id>=t.id?-1:1})))})).catch((function(e){console.log(e.response.data),alert(e.response.data)})):e;t([])}else console.log("no tokens to perferm booklist functions")}(a,r,e)}]},E=Object(n.createContext)(),k=function(e){var t=v(),a=Object(l.a)(t,2),n=a[0],o=a[1];return r.a.createElement(E.Provider,{value:{bookList:n,dispatch:o}},e.children)},O=a(10),j=function(){var e=function(){var e=localStorage.getItem("token");return Boolean(e)?m()(e):null}();return e?{username:e.username}:{username:""}}();function w(e){localStorage.setItem("token",e)}var y=function(){var e=Object(n.useState)(j),t=Object(l.a)(e,2),a=t[0],r=t[1];return[a,function(e){!function(e,t,a){var n=a.type,r=void 0===n?"":n,o=Object(i.a)(a,["type"]);if("removeLocalStorage"!==r)return"register"===r?(console.log(o),g.a.post("".concat(f,"/user/register"),{username:o.username,password:o.password}).then((function(e){w(e.headers["x-auth-token"]),window.location.assign("/")})).catch((function(e){e.response.data.indexOf("user"),o.setErrMsg("username",e.response.data)}))):"login"===r?g.a.post("".concat(f,"/user/login"),o).then((function(e){w(e.headers["x-auth-token"]),window.location.assign("/")})).catch((function(e){e.response.data.indexOf("user")>-1?o.setErrMsg("username",e.response.data):o.setErrMsg("password",e.response.data)})):e;localStorage.removeItem("token"),t(Object(O.a)({},e,{username:""}))}(a,r,e)}]},x=Object(n.createContext)(),C=function(e){var t=y(),a=Object(l.a)(t,2),n=a[0],o=a[1];return r.a.createElement(x.Provider,{value:{user:n,dispatch:o}},e.children)},B=function(e){var t=Object(n.useState)(""),a=Object(l.a)(t,2),o=a[0],s=a[1],c=Object(n.useState)(""),u=Object(l.a)(c,2),i=u[0],d=u[1],m=Object(n.useContext)(E).dispatch,p=Object(n.useContext)(x).user;return r.a.createElement(r.a.Fragment,null,p.username&&r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),m({type:"addBook",book:{title:o,author:i||Date().substr(0,24),id:Date.now()}}),s(""),d("")}},r.a.createElement("input",{placeholder:"title",type:"text",value:o,onChange:function(e){s(e.currentTarget.value)},required:!0}),r.a.createElement("input",{placeholder:"author",type:"text",value:i,onChange:function(e){d(e.currentTarget.value)}}),r.a.createElement("input",{type:"submit",value:"Add Book"})))},S=function(e){var t=e.book;Object(n.useEffect)((function(){a.current.onmouseenter=function(e){e.currentTarget.parentNode.style="opacity:0.7;  text-decoration: line-through;"},a.current.onmouseleave=function(e){e.currentTarget.parentNode.style="opacity:1;  text-decoration: none;"}}),[]);var a=Object(n.useRef)(),o=Object(n.useContext)(E).dispatch;return r.a.createElement("li",null,r.a.createElement("button",{className:"deleteBtn",ref:a,onClick:function(){o({type:"deleteBook",id:t.id})}},"delete"),r.a.createElement("div",{className:"title"},t.title,"  "),r.a.createElement("div",{className:"author"},t.author," "))},T=function(e){var t=Object(n.useContext)(E),a=t.bookList,o=t.dispatch;return Object(n.useEffect)((function(){setTimeout((function(){o({type:"getBookList"})}),500)}),[]),r.a.createElement("div",{className:"book-list"},r.a.createElement(B,null),r.a.createElement("ul",null,a.map((function(e){return r.a.createElement(S,{key:e.id,book:e})}))))},N=a(11),L=function(e){var t=Object(n.useContext)(E),a=t.bookList,o=t.dispatch,s=Object(n.useContext)(x),c=s.user,l=s.dispatch;return console.log(Boolean(c.username)),r.a.createElement(r.a.Fragment,null,r.a.createElement("nav",{className:"navbar"},r.a.createElement("h1",null,c.username," Reading List..."),r.a.createElement("p",null,"Currently you have ",a.length," books to get through...")),r.a.createElement("button",null," ",r.a.createElement(N.b,{to:"/"},"home ")," "),!c.username&&r.a.createElement("button",null,"  ",r.a.createElement(N.b,{to:"/login"},"login  ")),!c.username&&r.a.createElement("button",null,"  ",r.a.createElement(N.b,{to:"/register"},"register  ")),c.username&&r.a.createElement("button",{style:{float:"right"},onClick:function(){o({type:"logout"}),l({type:"removeLocalStorage"}),window.location.assign("/")}},"logout"),Boolean(a.length)?r.a.createElement("p",null):r.a.createElement("p",{style:{textAlign:"center"}},"No books to read, Hello free time :)"))},R=a(14),D=a(15),F=a.n(D),I=function(e){var t=e.isRegisterForm,a=Object(n.useContext)(x),o=a.user,s=a.dispatch;o.username&&e.history.push("/");var c=Object(n.useState)({format:t?["text","password","password"]:["text","password"],data:t?{username:"",password:"",password2:""}:{username:"",password:""},error:t?{username:"",password:"",password2:""}:{username:"",password:""}}),i=Object(l.a)(c,2),d=i[0],m=i[1],p=function(e,t){m(Object(O.a)({},d,{error:Object(O.a)({},d.error,Object(R.a)({},e,t))}))},g=Object(n.useRef)(),f={username:F.a.string().min(3).required().label("Username"),password:F.a.string().min(3).required().label("Password"),password2:F.a.any().valid(d.data.password).required().options({language:{any:{allowOnly:"is not matching"}}}).label("Retyped Passwrod")},b=function(e){d.data[e.currentTarget.name]=e.currentTarget.value,d.error=h(e)?Object(O.a)({},d.error,Object(R.a)({},e.currentTarget.name,h(e))):(delete d.error[e.currentTarget.name],d.error),t&&"password"===e.currentTarget.name&&(d.error.password||(d.data.password===d.data.password2?delete d.error.password2:d.error.password2="Two passwords are not matching")),m(Object(O.a)({},d))},h=function(e){var t=F.a.validate(e.currentTarget.value,f[e.currentTarget.name],{abortEarly:!1});return t.error?t.error.details[0].message:null};return r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),s(Object(O.a)({type:t?"register":"login"},d.data,{setErrMsg:p}))}},Object.keys(d.data).map((function(e,t){return r.a.createElement("div",{className:"form-group",key:e},r.a.createElement("label",{htmlFor:e},Object(u.a)(e).shift().toLocaleUpperCase(),e.substr(1)),r.a.createElement("input",{id:e,className:"form-control",type:d.format[t],name:e,value:d.data[e],onChange:b}),r.a.createElement("div",null,d.error[e]))})),r.a.createElement("div",null,r.a.createElement("input",{ref:g,type:"submit",disabled:Boolean(Object.keys(d.error).length),value:t?"Regist":"Login"})))},P=function(e){return r.a.createElement(I,Object.assign({isRegisterForm:!1},e))},q=function(e){return r.a.createElement(I,Object.assign({isRegisterForm:!0},e))};console.log("production");var M=function(e){return r.a.createElement("div",{className:"App"},r.a.createElement(n.Suspense,null),r.a.createElement(C,null,r.a.createElement(k,null,r.a.createElement(L,null),r.a.createElement(c.c,null,r.a.createElement(c.a,{path:"/login",render:function(e){return r.a.createElement(P,e)}}),r.a.createElement(c.a,{path:"/register",render:function(e){return r.a.createElement(q,e)}}),r.a.createElement(T,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(N.a,null,r.a.createElement(M,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[34,1,2]]]);
//# sourceMappingURL=main.c472e782.chunk.js.map