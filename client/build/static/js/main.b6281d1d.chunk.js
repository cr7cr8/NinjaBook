(this.webpackJsonpninjabook=this.webpackJsonpninjabook||[]).push([[0],{40:function(e,t,n){e.exports=n(85)},45:function(e,t,n){},66:function(e,t,n){e.exports=n.p+"static/media/11.5812c186.jpg"},85:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(21),i=n.n(r),c=(n(45),n(13)),l=n(3),s=n(6),u=n(12),d=n(17),m=n.n(d),f=n(9),p=n.n(f),b="/api";n(65);h()&&(p.a.defaults.headers.common["x-auth-token"]=h());var g=h()?[{title:"... loading ...",author:Date(),id:Date.now()}]:[{title:"Please login to use",author:Date(),id:Date.now()}];function h(){return localStorage.getItem("token")}var j=Object(a.createContext)(),E=function(e){var t=Object(a.useState)(g),n=Object(l.a)(t,2),r=n[0],i=n[1];return o.a.createElement(j.Provider,{value:{bookList:r,dispatch:function(e){return function(e,t,n){var a=n.type,o=void 0===a?"":a,r=Object(u.a)(n,["type"]);if("initialize"===o);else{if("toggleStatus"===o){var i=e.find((function(e){return e.id===r.id}));return i.finish=!i.finish,t(Object(s.a)(e)),console.log(e.find((function(e){return e.id===r.id}))),p.a.put("".concat(b,"/booklist/updatebook/")+r.id,i).then((function(e){})).catch((function(n){var a=e.find((function(e){return e.id===r.id}));a.finish=!a.finish,t(Object(s.a)(e)),console.log(n.response.data),alert(n.response.data)}))}if(h()){if("deleteBook"===o){var c=e.filter((function(e){if(e.id!==r.id)return e}));return p.a.delete("".concat(b,"/booklist/deletebook/")+r.id).then((function(e){setTimeout((function(){t(c)}),500)})).catch((function(n){t(Object(s.a)(e)),console.log(n.response),alert(n.response.data)}))}if("logout"===o)t([]);else{if("cleanFinish"!==o){if("getBookList"===o)return p.a.get(r.justUnfished?"".concat(b,"/booklist/getunfinishedbooklist"):"".concat(b,"/booklist/getbooklist")).then((function(e){var n=e.data.map((function(e){return{title:e.title,author:e.author,id:e.id,finish:e.finish,files:e.files}}));t(n)})).catch((function(e){console.log(e.response.data),alert(e.response.data)}));if("addBook"===o)return t([].concat(Object(s.a)(e),[r.book]).sort((function(e,t){return e.id>=t.id?-1:1}))),p.a.post("".concat(b,"/booklist/addbook"),r.book).then((function(e){})).catch((function(n){t(e),console.log(n.response.data),alert(n.response.data)}));if("uploadFile"===o){t([].concat(Object(s.a)(e),[r.book]).sort((function(e,t){return e.id>=t.id?-1:1})));var l=new FormData;return r.file&&l.append("file",r.file),l.append("obj",JSON.stringify(r.book)),p.a.post("".concat(b,"/booklist/upload"),l,{headers:{"content-type":"multipart/form-data"},onUploadProgress:function(e){var t=Math.floor(100*e.loaded/e.total);console.log(t)}}).then((function(e){r.setFile(null),console.log(e.data)})).catch((function(e){console.log(e.response.data),alert(e.response.data)}))}return"downloadFile"===o?p()({url:"".concat(b,"/booklist/download/").concat(String(r.id)),method:"GET",responseType:"blob",onDownloadProgress:function(e){r.obj((100*e.loaded/e.total).toFixed(2)+"%"),console.log((100*e.loaded/e.total).toFixed(2))}}).then((function(e){var t=window.URL.createObjectURL(new Blob([e.data])),n=document.createElement("a");n.href=t,n.setAttribute("download",decodeURIComponent(e.headers["file-name"])),document.body.appendChild(n),n.click()})).catch((function(e){console.log(e.response.data),alert(e.response.data)})):e}t(e.filter((function(e){return!0!==e.finish})))}}else console.log("no tokens to perferm booklist functions")}}(r,i,e)}}},e.children)},k=n(14),O=function(){var e=function(){var e=localStorage.getItem("token");return Boolean(e)?m()(e):null}();return e?{username:e.username}:{username:""}}();function v(e){localStorage.setItem("token",e)}var w=Object(a.createContext)(),y=function(e){var t=Object(a.useState)(O),n=Object(l.a)(t,2),r=n[0],i=n[1];return o.a.createElement(w.Provider,{value:{user:r,dispatch:function(e){return function(e,t,n){var a=n.type,o=void 0===a?"":a,r=Object(u.a)(n,["type"]);if("removeLocalStorage"!==o)return"register"===o?p.a.post("".concat(b,"/user/register"),{username:r.username,password:r.password}).then((function(e){v(e.headers["x-auth-token"]),window.location.assign("/")})).catch((function(e){e.response.data.indexOf("user"),r.setErrMsg("username",e.response.data)})):"login"===o?p.a.post("".concat(b,"/user/login"),r).then((function(e){v(e.headers["x-auth-token"]),window.location.assign("/")})).catch((function(e){e.response.data.indexOf("user")>-1?r.setErrMsg("username",e.response.data):r.setErrMsg("password",e.response.data)})):e;localStorage.removeItem("token"),t(Object(k.a)({},e,{username:""}))}(r,i,e)}}},e.children)},x=(n(66),n(36)),C=function(e){var t=Object(a.useState)(""),n=Object(l.a)(t,2),r=n[0],i=n[1],c=Object(a.useState)(""),s=Object(l.a)(c,2),u=s[0],d=s[1],m=Object(a.useState)(null),f=Object(l.a)(m,2),p=f[0],b=f[1],g=Object(a.useContext)(j).dispatch,h=(Object(a.useContext)(w).user,Object(a.createRef)());return o.a.createElement(o.a.Fragment,null,o.a.createElement(x.a,{value:r,placeholder:"title",onChange:function(e){i(e.currentTarget.value)}}),o.a.createElement("input",{placeholder:Date().substr(0,24),type:"text",value:u,onChange:function(e){d(e.currentTarget.value)}}),p&&o.a.createElement("img",{src:p?URL.createObjectURL(p):"",style:{opacity:1,width:200,height:100}}),o.a.createElement("div",null,o.a.createElement("input",{type:"file",style:{display:"none"},onChange:function(e){e.preventDefault(),console.log(e.currentTarget.files[0]),i((r+" "+e.currentTarget.files[0].name).trim()),e.currentTarget.files[0]?b(e.currentTarget.files[0]):b(null)},ref:function(e){return h=e}}),o.a.createElement("button",{className:"btn",onClick:function(){h.click()}},"File"),o.a.createElement("button",{disabled:!r,className:"btn",style:{float:"right",marginTop:"5px"},onClick:function(e){e.preventDefault(),""!==r&&(g({type:"uploadFile",setFile:b,file:p,book:{title:r,files:p?[p.name]:null,author:u||Date().substr(0,24),id:Date.now(),finish:!1}}),i(""),d(""))}},"Add Book")))},S=n(22),T=n(19),F=function(e){var t=e.whenClick,n=Object(u.a)(e,["whenClick"]),r=Object(a.useState)("0%"),i=Object(l.a)(r,2),c=i[0],s=i[1],d=Object(a.useState)(!1),m=Object(l.a)(d,2),f=m[0],p=m[1],b=Object(T.b)({from:{width:"0%"},margin:"0",height:"20px",width:c,paddingLeft:"10px",padding:"0",background:"linear-gradient(to right, #4880EC, #019CAD)",whiteSpace:"nowrap"});return o.a.createElement(o.a.Fragment,null,o.a.createElement("button",Object.assign({disabled:f,style:{padding:"0",border:"0"},onClick:function(){p(!0),t(s)}},n),o.a.createElement(T.a.div,{style:b},n.children)))},N=function(e){var t=e.book,n=(Object(u.a)(e,["book"]),0),r=!1,i=Object(a.useContext)(j).dispatch,c=Object(a.useState)(1),s=Object(l.a)(c,2),d=s[0],m=s[1],f=Object(a.useState)("auto"),p=Object(l.a)(f,2),b=p[0],g=p[1];return o.a.createElement(S.Spring,{from:{opacity:0,height:0},to:{opacity:d,height:b}},(function(e){return o.a.createElement("li",{className:t.finish?"done":"",style:e},o.a.createElement("button",{className:"deleteBtn",onClick:function(){n=setTimeout((function(){r||i({type:"toggleStatus",id:t.id}),r=!1}),200)},onDoubleClick:function(){clearTimeout(n),r=!0,m(0),g(0),i({type:"deleteBook",id:t.id})},onMouseEnter:function(e){e.currentTarget.parentNode.style="opacity:0.7;  text-decoration: line-through;"},onMouseOut:function(e){e.currentTarget.parentNode.style="opacity:1;  text-decoration: none;"}},"delete"),o.a.createElement("div",{className:t.finish?"title done":"title"},t.title,"  "),o.a.createElement("div",{className:t.finish?"author done":"author"},t.author," "),t.files&&o.a.createElement(F,{whenClick:function(e){i({type:"downloadFile",id:t.id,obj:e})},className:"btn bar"},t.files[0]))}))},L=function(e){var t=Object(a.useContext)(j),n=t.bookList,r=t.dispatch;return Object(a.useEffect)((function(){setTimeout((function(){r({type:"getBookList",justUnfished:!0})}),0)}),[]),o.a.createElement("div",{className:"book-list "},o.a.createElement(C,null),o.a.createElement("ul",null,n.map((function(t){return o.a.createElement(N,Object.assign({style:e},{key:t.id,book:t}))}))))},B=n(15),D=n(37),R=n.n(D),U=function(e){var t=Object(a.useContext)(j),n=t.bookList,r=t.dispatch,i=Object(a.useContext)(w),c=i.user,s=i.dispatch,u=Object(a.useState)(!1),d=Object(l.a)(u,2),m=d[0],f=d[1];return o.a.createElement(o.a.Fragment,null,o.a.createElement("nav",{className:"navbar",style:e},o.a.createElement("h1",null,c.username," Reading List..."),o.a.createElement("p",null,"Currently you have ",n.length," books to get through..."),o.a.createElement(R.a,{checked:m,onChange:function(){r(m?{type:"cleanFinish"}:{type:"getBookList"}),f(!m)},onColor:"#6d3d6d",offColor:"#6d3d6d",offHandleColor:"#eeeeee",onHandleColor:"#eeeeee",handleDiameter:30,uncheckedIcon:!1,checkedIcon:!1,boxShadow:"0px 1px 5px rgba(0, 0, 0, 0.6)",activeBoxShadow:"0px 0px 1px 10px rgba(0, 0, 0, 0.2)",height:1,width:48,className:"react-switch",id:"material-switch"})),o.a.createElement("button",null," ",o.a.createElement(B.b,{to:"/"},"home ")," "),!c.username&&o.a.createElement("button",null,"  ",o.a.createElement(B.b,{to:"/login"},"login  ")),!c.username&&o.a.createElement("button",null,"  ",o.a.createElement(B.b,{to:"/register"},"register  ")),c.username&&o.a.createElement("button",{style:{float:"right"},onClick:function(){r({type:"logout"}),s({type:"removeLocalStorage"}),window.location.assign("/")}},"logout"),Boolean(n.length)||o.a.createElement("p",{style:{textAlign:"center"}},"No books to read, Hello free time :)"))},I=n(10),M=n(18),P=n.n(M),A=function(e){var t=e.isRegisterForm,n=Object(a.useContext)(w),r=n.user,i=n.dispatch;r.username&&e.history.push("/");var c=Object(a.useState)({format:t?["text","password","password"]:["text","password"],data:t?{username:"",password:"",password2:""}:{username:"",password:""},error:t?{username:"",password:"",password2:""}:{username:"",password:""}}),u=Object(l.a)(c,2),d=u[0],m=u[1],f=function(e,t){m(Object(k.a)({},d,{error:Object(k.a)({},d.error,Object(I.a)({},e,t))}))},p=Object(a.useRef)(),b={username:P.a.string().min(3).required().label("Username"),password:P.a.string().min(3).required().label("Password"),password2:P.a.any().valid(d.data.password).required().options({language:{any:{allowOnly:"is not matching"}}}).label("Retyped Passwrod")},g=function(e){d.data[e.currentTarget.name]=e.currentTarget.value,d.error=h(e)?Object(k.a)({},d.error,Object(I.a)({},e.currentTarget.name,h(e))):(delete d.error[e.currentTarget.name],d.error),t&&"password"===e.currentTarget.name&&(d.error.password||(d.data.password===d.data.password2?delete d.error.password2:d.error.password2="Two passwords are not matching")),m(Object(k.a)({},d))},h=function(e){var t=P.a.validate(e.currentTarget.value,b[e.currentTarget.name],{abortEarly:!1});return t.error?t.error.details[0].message:null};return o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),i(Object(k.a)({type:t?"register":"login"},d.data,{setErrMsg:f}))}},Object.keys(d.data).map((function(e,t){return o.a.createElement("div",{className:"form-group",key:e},o.a.createElement("label",{htmlFor:e},Object(s.a)(e).shift().toLocaleUpperCase(),e.substr(1)),o.a.createElement("input",{id:e,className:"form-control",type:d.format[t],name:e,value:d.data[e],onChange:g}),o.a.createElement("div",null,d.error[e]))})),o.a.createElement("div",null,o.a.createElement("input",{ref:p,type:"submit",disabled:Boolean(Object.keys(d.error).length),value:t?"Regist":"Login"})))},q=function(e){return o.a.createElement(A,Object.assign({isRegisterForm:!1},e))},H=function(e){return o.a.createElement(A,Object.assign({isRegisterForm:!0},e))};console.log("production");var J=function(e){return o.a.createElement("div",{className:"App"},o.a.createElement(a.Suspense,null),o.a.createElement(y,null,o.a.createElement(E,null,o.a.createElement(U,null),o.a.createElement(c.c,null,o.a.createElement(c.a,{path:"/login",render:function(e){return o.a.createElement(q,e)}}),o.a.createElement(c.a,{path:"/register",render:function(e){return o.a.createElement(H,e)}}),o.a.createElement(L,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(B.a,null,o.a.createElement(J,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[40,1,2]]]);
//# sourceMappingURL=main.b6281d1d.chunk.js.map