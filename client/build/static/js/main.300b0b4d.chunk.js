(this.webpackJsonpninjabook=this.webpackJsonpninjabook||[]).push([[0],{34:function(e,t,n){e.exports=n(64)},39:function(e,t,n){},64:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(31),s=n.n(o),c=(n(39),n(9)),i=n(6),l=n(12),u=n(17),d=n(13),m=n.n(d),f=n(8),p=n.n(f),g="/api";h()&&(p.a.defaults.headers.common["x-auth-token"]=h());var b=h()?[]:[{title:"Please login to use",author:Date(),id:Date.now()}];function h(){return localStorage.getItem("token")}var v=Object(a.createContext)(),E=function(e){var t=Object(a.useState)(b),n=Object(i.a)(t,2),o=n[0],s=n[1];return r.a.createElement(v.Provider,{value:{bookList:o,dispatch:function(e){return function(e,t,n){var a=n.type,r=void 0===a?"":a,o=Object(u.a)(n,["type"]);if("initialize"===r);else{if("toggleStatus"===r){var s=e.find((function(e){return e.id===o.id}));return s.finish=!s.finish,t(Object(l.a)(e)),console.log(e.find((function(e){return e.id===o.id}))),p.a.put("".concat(g,"/booklist/updatebook/")+o.id,s).then((function(e){})).catch((function(n){var a=e.find((function(e){return e.id===o.id}));a.finish=!a.finish,t(Object(l.a)(e)),console.log(n.response.data),alert(n.response.data)}))}if(h()){if("deleteBook"===r){var c=e.filter((function(e){if(e.id!==o.id)return e}));return t(c),p.a.delete("".concat(g,"/booklist/deletebook/")+o.id).then((function(e){})).catch((function(n){t(Object(l.a)(e)),console.log(n.response),alert(n.response.data)}))}if("logout"!==r)return"getBookList"===r?p.a.get("".concat(g,"/booklist/getbooklist")).then((function(e){var n=e.data.map((function(e){return{title:e.title,author:e.author,id:e.id,finish:e.finish}}));t(n)})).catch((function(e){console.log(e.response.data),alert(e.response.data)})):"addBook"===r?(t([].concat(Object(l.a)(e),[o.book]).sort((function(e,t){return e.id>=t.id?-1:1}))),p.a.post("".concat(g,"/booklist/addbook"),o.book).then((function(e){})).catch((function(n){t(e),console.log(n.response.data),alert(n.response.data)}))):e;t([])}else console.log("no tokens to perferm booklist functions")}}(o,s,e)}}},e.children)},k=n(10),O=function(){var e=function(){var e=localStorage.getItem("token");return Boolean(e)?m()(e):null}();return e?{username:e.username}:{username:""}}();function j(e){localStorage.setItem("token",e)}var w=Object(a.createContext)(),y=function(e){var t=Object(a.useState)(O),n=Object(i.a)(t,2),o=n[0],s=n[1];return r.a.createElement(w.Provider,{value:{user:o,dispatch:function(e){return function(e,t,n){var a=n.type,r=void 0===a?"":a,o=Object(u.a)(n,["type"]);if("removeLocalStorage"!==r)return"register"===r?p.a.post("".concat(g,"/user/register"),{username:o.username,password:o.password}).then((function(e){j(e.headers["x-auth-token"]),window.location.assign("/")})).catch((function(e){e.response.data.indexOf("user"),o.setErrMsg("username",e.response.data)})):"login"===r?p.a.post("".concat(g,"/user/login"),o).then((function(e){j(e.headers["x-auth-token"]),window.location.assign("/")})).catch((function(e){e.response.data.indexOf("user")>-1?o.setErrMsg("username",e.response.data):o.setErrMsg("password",e.response.data)})):e;localStorage.removeItem("token"),t(Object(k.a)({},e,{username:""}))}(o,s,e)}}},e.children)},x=function(e){var t=Object(a.useState)(""),n=Object(i.a)(t,2),o=n[0],s=n[1],c=Object(a.useState)(""),l=Object(i.a)(c,2),u=l[0],d=l[1],m=Object(a.useContext)(v).dispatch,f=Object(a.useContext)(w).user;return r.a.createElement(r.a.Fragment,null,f.username&&r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),m({type:"addBook",book:{title:o,author:u||Date().substr(0,24),id:Date.now(),finish:!1}}),s(""),d("")}},r.a.createElement("input",{placeholder:"title",type:"text",value:o,onChange:function(e){s(e.currentTarget.value)},required:!0}),r.a.createElement("input",{placeholder:"author",type:"text",value:u,onChange:function(e){d(e.currentTarget.value)}}),r.a.createElement("input",{type:"submit",value:"Add Book"})))},C=function(e){var t=e.book;Object(a.useEffect)((function(){s.current.onmouseenter=function(e){e.currentTarget.parentNode.style="opacity:0.7;  text-decoration: line-through;"},s.current.onmouseleave=function(e){e.currentTarget.parentNode.style="opacity:1;  text-decoration: none;"}}),[]);var n=0,o=!1,s=Object(a.useRef)(),c=Object(a.useContext)(v).dispatch;return r.a.createElement("li",{className:t.finish?"done":""},r.a.createElement("button",{className:"deleteBtn",ref:s,onClick:function(){n=setTimeout((function(){o||c({type:"toggleStatus",id:t.id}),o=!1}),200)},onDoubleClick:function(){clearTimeout(n),o=!0,c({type:"deleteBook",id:t.id})}},"delete"),r.a.createElement("div",{className:t.finish?"title done":"title"},t.title,"  "),r.a.createElement("div",{className:t.finish?"author done":"author"},t.author," "))},S=function(e){var t=Object(a.useContext)(v),n=t.bookList,o=t.dispatch;return Object(a.useEffect)((function(){setTimeout((function(){o({type:"getBookList"})}),0)}),[]),r.a.createElement("div",{className:"book-list "},r.a.createElement(x,null),r.a.createElement("ul",null,n.map((function(e){return r.a.createElement(C,{key:e.id,book:e})}))))},T=n(11),B=function(e){var t=Object(a.useContext)(v),n=t.bookList,o=t.dispatch,s=Object(a.useContext)(w),c=s.user,i=s.dispatch;return console.log(Boolean(c.username)),r.a.createElement(r.a.Fragment,null,r.a.createElement("nav",{className:"navbar"},r.a.createElement("h1",null,c.username," Reading List..."),r.a.createElement("p",null,"Currently you have ",n.length," books to get through...")),r.a.createElement("button",null," ",r.a.createElement(T.b,{to:"/"},"home ")," "),!c.username&&r.a.createElement("button",null,"  ",r.a.createElement(T.b,{to:"/login"},"login  ")),!c.username&&r.a.createElement("button",null,"  ",r.a.createElement(T.b,{to:"/register"},"register  ")),c.username&&r.a.createElement("button",{style:{float:"right"},onClick:function(){o({type:"logout"}),i({type:"removeLocalStorage"}),window.location.assign("/")}},"logout"),Boolean(n.length)?r.a.createElement("p",null):r.a.createElement("p",{style:{textAlign:"center"}},"No books to read, Hello free time :)"))},N=n(15),L=n(16),R=n.n(L),D=function(e){var t=e.isRegisterForm,n=Object(a.useContext)(w),o=n.user,s=n.dispatch;o.username&&e.history.push("/");var c=Object(a.useState)({format:t?["text","password","password"]:["text","password"],data:t?{username:"",password:"",password2:""}:{username:"",password:""},error:t?{username:"",password:"",password2:""}:{username:"",password:""}}),u=Object(i.a)(c,2),d=u[0],m=u[1],f=function(e,t){m(Object(k.a)({},d,{error:Object(k.a)({},d.error,Object(N.a)({},e,t))}))},p=Object(a.useRef)(),g={username:R.a.string().min(3).required().label("Username"),password:R.a.string().min(3).required().label("Password"),password2:R.a.any().valid(d.data.password).required().options({language:{any:{allowOnly:"is not matching"}}}).label("Retyped Passwrod")},b=function(e){d.data[e.currentTarget.name]=e.currentTarget.value,d.error=h(e)?Object(k.a)({},d.error,Object(N.a)({},e.currentTarget.name,h(e))):(delete d.error[e.currentTarget.name],d.error),t&&"password"===e.currentTarget.name&&(d.error.password||(d.data.password===d.data.password2?delete d.error.password2:d.error.password2="Two passwords are not matching")),m(Object(k.a)({},d))},h=function(e){var t=R.a.validate(e.currentTarget.value,g[e.currentTarget.name],{abortEarly:!1});return t.error?t.error.details[0].message:null};return r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),s(Object(k.a)({type:t?"register":"login"},d.data,{setErrMsg:f}))}},Object.keys(d.data).map((function(e,t){return r.a.createElement("div",{className:"form-group",key:e},r.a.createElement("label",{htmlFor:e},Object(l.a)(e).shift().toLocaleUpperCase(),e.substr(1)),r.a.createElement("input",{id:e,className:"form-control",type:d.format[t],name:e,value:d.data[e],onChange:b}),r.a.createElement("div",null,d.error[e]))})),r.a.createElement("div",null,r.a.createElement("input",{ref:p,type:"submit",disabled:Boolean(Object.keys(d.error).length),value:t?"Regist":"Login"})))},F=function(e){return r.a.createElement(D,Object.assign({isRegisterForm:!1},e))},I=function(e){return r.a.createElement(D,Object.assign({isRegisterForm:!0},e))};console.log("production");var P=function(e){return r.a.createElement("div",{className:"App"},r.a.createElement(a.Suspense,null),r.a.createElement(y,null,r.a.createElement(E,null,r.a.createElement(B,null),r.a.createElement(c.c,null,r.a.createElement(c.a,{path:"/login",render:function(e){return r.a.createElement(F,e)}}),r.a.createElement(c.a,{path:"/register",render:function(e){return r.a.createElement(I,e)}}),r.a.createElement(S,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(T.a,null,r.a.createElement(P,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[34,1,2]]]);
//# sourceMappingURL=main.300b0b4d.chunk.js.map