(this.webpackJsonpninjabook=this.webpackJsonpninjabook||[]).push([[0],{36:function(e,t,n){e.exports=n(78)},41:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(19),s=n.n(o),c=(n(41),n(9)),i=n(4),l=n(12),u=n(13),d=n(14),m=n.n(d),p=n(8),f=n.n(p),g="/api";h()&&(f.a.defaults.headers.common["x-auth-token"]=h());var b=h()?[{title:"... loading ...",author:Date(),id:Date.now()}]:[{title:"Please login to use",author:Date(),id:Date.now()}];function h(){return localStorage.getItem("token")}var E=Object(a.createContext)(),v=function(e){var t=Object(a.useState)(b),n=Object(i.a)(t,2),o=n[0],s=n[1];return r.a.createElement(E.Provider,{value:{bookList:o,dispatch:function(e){return function(e,t,n){var a=n.type,r=void 0===a?"":a,o=Object(u.a)(n,["type"]);if("initialize"===r);else{if("toggleStatus"===r){var s=e.find((function(e){return e.id===o.id}));return s.finish=!s.finish,t(Object(l.a)(e)),console.log(e.find((function(e){return e.id===o.id}))),f.a.put("".concat(g,"/booklist/updatebook/")+o.id,s).then((function(e){})).catch((function(n){var a=e.find((function(e){return e.id===o.id}));a.finish=!a.finish,t(Object(l.a)(e)),console.log(n.response.data),alert(n.response.data)}))}if(h()){if("deleteBook"===r){var c=e.filter((function(e){if(e.id!==o.id)return e}));return f.a.delete("".concat(g,"/booklist/deletebook/")+o.id).then((function(e){setTimeout((function(){t(c)}),500)})).catch((function(n){t(Object(l.a)(e)),console.log(n.response),alert(n.response.data)}))}if("logout"!==r)return"getBookList"===r?f.a.get("".concat(g,"/booklist/getbooklist")).then((function(e){var n=e.data.map((function(e){return{title:e.title,author:e.author,id:e.id,finish:e.finish}}));t(n)})).catch((function(e){console.log(e.response.data),alert(e.response.data)})):"addBook"===r?(t([].concat(Object(l.a)(e),[o.book]).sort((function(e,t){return e.id>=t.id?-1:1}))),f.a.post("".concat(g,"/booklist/addbook"),o.book).then((function(e){})).catch((function(n){t(e),console.log(n.response.data),alert(n.response.data)}))):e;t([])}else console.log("no tokens to perferm booklist functions")}}(o,s,e)}}},e.children)},O=n(10),k=function(){var e=function(){var e=localStorage.getItem("token");return Boolean(e)?m()(e):null}();return e?{username:e.username}:{username:""}}();function j(e){localStorage.setItem("token",e)}var w=Object(a.createContext)(),y=function(e){var t=Object(a.useState)(k),n=Object(i.a)(t,2),o=n[0],s=n[1];return r.a.createElement(w.Provider,{value:{user:o,dispatch:function(e){return function(e,t,n){var a=n.type,r=void 0===a?"":a,o=Object(u.a)(n,["type"]);if("removeLocalStorage"!==r)return"register"===r?f.a.post("".concat(g,"/user/register"),{username:o.username,password:o.password}).then((function(e){j(e.headers["x-auth-token"]),window.location.assign("/")})).catch((function(e){e.response.data.indexOf("user"),o.setErrMsg("username",e.response.data)})):"login"===r?f.a.post("".concat(g,"/user/login"),o).then((function(e){j(e.headers["x-auth-token"]),window.location.assign("/")})).catch((function(e){e.response.data.indexOf("user")>-1?o.setErrMsg("username",e.response.data):o.setErrMsg("password",e.response.data)})):e;localStorage.removeItem("token"),t(Object(O.a)({},e,{username:""}))}(o,s,e)}}},e.children)},x=function(e){var t=Object(a.useState)(""),n=Object(i.a)(t,2),o=n[0],s=n[1],c=Object(a.useState)(""),l=Object(i.a)(c,2),u=l[0],d=l[1],m=Object(a.useContext)(E).dispatch,p=Object(a.useContext)(w).user;return r.a.createElement(r.a.Fragment,null,p.username&&r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),m({type:"addBook",book:{title:o,author:u||Date().substr(0,24),id:Date.now(),finish:!1}}),s(""),d("")}},r.a.createElement("input",{placeholder:"title",type:"text",value:o,onChange:function(e){s(e.currentTarget.value)},required:!0}),r.a.createElement("input",{placeholder:"author",type:"text",value:u,onChange:function(e){d(e.currentTarget.value)}}),r.a.createElement("input",{type:"submit",value:"Add Book"})))},S=n(33),C=function(e){var t=e.book,n=(Object(u.a)(e,["book"]),0),o=!1,s=Object(a.useContext)(E).dispatch,c=Object(a.useState)(1),l=Object(i.a)(c,2),d=l[0],m=l[1],p=Object(a.useState)("auto"),f=Object(i.a)(p,2),g=f[0],b=f[1];return r.a.createElement(S.Spring,{from:{opacity:0,height:0},to:{opacity:d,height:g}},(function(e){return r.a.createElement("li",{className:t.finish?"done":"",style:e},r.a.createElement("button",{className:"deleteBtn",onClick:function(){n=setTimeout((function(){o||s({type:"toggleStatus",id:t.id}),o=!1}),200)},onDoubleClick:function(){clearTimeout(n),o=!0,m(0),b(0),s({type:"deleteBook",id:t.id})},onMouseEnter:function(e){e.currentTarget.parentNode.style="opacity:0.7;  text-decoration: line-through;"},onMouseOut:function(e){e.currentTarget.parentNode.style="opacity:1;  text-decoration: none;"}},"delete"),r.a.createElement("div",{className:t.finish?"title done":"title"},t.title,"  "),r.a.createElement("div",{className:t.finish?"author done":"author"},t.author," "))}))},T=function(e){var t=Object(a.useContext)(E),n=t.bookList,o=t.dispatch;return Object(a.useEffect)((function(){setTimeout((function(){o({type:"getBookList"})}),0)}),[]),r.a.createElement("div",{className:"book-list "},r.a.createElement(x,null),r.a.createElement("ul",null,n.map((function(t){return r.a.createElement(C,Object.assign({style:e},{key:t.id,book:t}))}))))},B=n(11),N=function(e){var t=Object(a.useContext)(E),n=t.bookList,o=t.dispatch,s=Object(a.useContext)(w),c=s.user,i=s.dispatch;return console.log(Boolean(c.username)),r.a.createElement(r.a.Fragment,null,r.a.createElement("nav",{className:"navbar",style:e},r.a.createElement("h1",null,c.username," Reading List..."),r.a.createElement("p",null,"Currently you have ",n.length," books to get through...")),r.a.createElement("button",null," ",r.a.createElement(B.b,{to:"/"},"home ")," "),!c.username&&r.a.createElement("button",null,"  ",r.a.createElement(B.b,{to:"/login"},"login  ")),!c.username&&r.a.createElement("button",null,"  ",r.a.createElement(B.b,{to:"/register"},"register  ")),c.username&&r.a.createElement("button",{style:{float:"right"},onClick:function(){o({type:"logout"}),i({type:"removeLocalStorage"}),window.location.assign("/")}},"logout"),Boolean(n.length)?r.a.createElement("p",null):r.a.createElement("p",{style:{textAlign:"center"}},"No books to read, Hello free time :)"))},L=n(16),D=n(17),R=n.n(D),F=function(e){var t=e.isRegisterForm,n=Object(a.useContext)(w),o=n.user,s=n.dispatch;o.username&&e.history.push("/");var c=Object(a.useState)({format:t?["text","password","password"]:["text","password"],data:t?{username:"",password:"",password2:""}:{username:"",password:""},error:t?{username:"",password:"",password2:""}:{username:"",password:""}}),u=Object(i.a)(c,2),d=u[0],m=u[1],p=function(e,t){m(Object(O.a)({},d,{error:Object(O.a)({},d.error,Object(L.a)({},e,t))}))},f=Object(a.useRef)(),g={username:R.a.string().min(3).required().label("Username"),password:R.a.string().min(3).required().label("Password"),password2:R.a.any().valid(d.data.password).required().options({language:{any:{allowOnly:"is not matching"}}}).label("Retyped Passwrod")},b=function(e){d.data[e.currentTarget.name]=e.currentTarget.value,d.error=h(e)?Object(O.a)({},d.error,Object(L.a)({},e.currentTarget.name,h(e))):(delete d.error[e.currentTarget.name],d.error),t&&"password"===e.currentTarget.name&&(d.error.password||(d.data.password===d.data.password2?delete d.error.password2:d.error.password2="Two passwords are not matching")),m(Object(O.a)({},d))},h=function(e){var t=R.a.validate(e.currentTarget.value,g[e.currentTarget.name],{abortEarly:!1});return t.error?t.error.details[0].message:null};return r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),s(Object(O.a)({type:t?"register":"login"},d.data,{setErrMsg:p}))}},Object.keys(d.data).map((function(e,t){return r.a.createElement("div",{className:"form-group",key:e},r.a.createElement("label",{htmlFor:e},Object(l.a)(e).shift().toLocaleUpperCase(),e.substr(1)),r.a.createElement("input",{id:e,className:"form-control",type:d.format[t],name:e,value:d.data[e],onChange:b}),r.a.createElement("div",null,d.error[e]))})),r.a.createElement("div",null,r.a.createElement("input",{ref:f,type:"submit",disabled:Boolean(Object.keys(d.error).length),value:t?"Regist":"Login"})))},M=function(e){return r.a.createElement(F,Object.assign({isRegisterForm:!1},e))},I=function(e){return r.a.createElement(F,Object.assign({isRegisterForm:!0},e))};console.log("production");var P=function(e){return r.a.createElement("div",{className:"App"},r.a.createElement(a.Suspense,null),r.a.createElement(y,null,r.a.createElement(v,null,r.a.createElement(N,null),r.a.createElement(c.c,null,r.a.createElement(c.a,{path:"/login",render:function(e){return r.a.createElement(M,e)}}),r.a.createElement(c.a,{path:"/register",render:function(e){return r.a.createElement(I,e)}}),r.a.createElement(T,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(B.a,null,r.a.createElement(P,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[36,1,2]]]);
//# sourceMappingURL=main.ae2b591c.chunk.js.map