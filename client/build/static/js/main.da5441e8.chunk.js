(this.webpackJsonpninjabook=this.webpackJsonpninjabook||[]).push([[0],{34:function(e,t,a){e.exports=a(64)},39:function(e,t,a){},64:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(31),s=a.n(o),c=(a(39),a(9)),l=a(3),u=a(17),i=a(16),d=a(12),m=a.n(d),p=a(10),b=a.n(p),f="/api";h()&&(b.a.defaults.headers.common["x-auth-token"]=h());var g=h()?[]:[{title:"Please login to use",author:Date(),id:Date.now()}];function h(){return localStorage.getItem("token")}var v=function(){var e=Object(n.useState)(g),t=Object(l.a)(e,2),a=t[0],r=t[1];return[a,function(e){!function(e,t,a){var n=a.type,r=void 0===n?"":n,o=Object(i.a)(a,["type"]);if("initialize"===r);else if(h()){if("deleteBook"===r)return b.a.delete("".concat(f,"/booklist/deletebook/")+o.id).then((function(a){var n=e.filter((function(e){return e.id!==o.id}));t(n)})).catch((function(e){console.log(e.response.data),alert(e.response.data)}));if("logout"!==r)return"getBookList"===r?b.a.get("".concat(f,"/booklist/getbooklist")).then((function(e){var a=e.data.map((function(e){return{title:e.title,author:e.author,id:e.id}}));t(a)})).catch((function(e){console.log(e.response.data),alert(e.response.data)})):"addBook"===r?b.a.post("".concat(f,"/booklist/addbook"),o.book).then((function(a){t([].concat(Object(u.a)(e),[o.book]).sort((function(e,t){return e.id>=t.id?-1:1})))})).catch((function(e){console.log(e.response.data),alert(e.response.data)})):e;t([])}else console.log("no tokens to perferm booklist functions")}(a,r,e)}]},E=Object(n.createContext)(),j=function(e){var t=v(),a=Object(l.a)(t,2),n=a[0],o=a[1];return r.a.createElement(E.Provider,{value:{bookList:n,dispatch:o}},e.children)},O=a(6),k=function(){var e=function(){var e=localStorage.getItem("token");return Boolean(e)?m()(e):null}();return e?{username:e.username}:{username:""}}();function w(e){localStorage.setItem("token",e)}var y=function(){var e=Object(n.useState)(k),t=Object(l.a)(e,2),a=t[0],r=t[1];return[a,function(e){var t=function(e,t){var a=t.type,n=void 0===a?"":a,r=Object(i.a)(t,["type"]);return"removeLocalStorage"===n?(localStorage.removeItem("token"),{username:""}):"register"===n?(console.log(r),b.a.post("".concat(f,"/user/register"),{username:r.username,password:r.password}).then((function(e){return w(e.headers["x-auth-token"]),Promise.resolve(e.data)})).catch((function(e){return e.response.data.indexOf("user"),r.setErrMsg("username",e.response.data),Promise.reject(e.response.data)}))):"login"===n?b.a.post("".concat(f,"/user/login"),r).then((function(e){return w(e.headers["x-auth-token"]),Promise.resolve(e.data)})).catch((function(e){return e.response.data.indexOf("user")>-1?r.setErrMsg("username",e.response.data):r.setErrMsg("password",e.response.data),Promise.reject(e.response.data)})):e}(a,e);Promise.resolve(t)!==t?r(Object(O.a)({},a,{},t)):t.then((function(e){r(Object(O.a)({},a,{},e)),window.location.assign("/")})).catch((function(e){r(Object(O.a)({},a))}))}]},x=Object(n.createContext)(),C=function(e){var t=y(),a=Object(l.a)(t,2),n=a[0],o=a[1];return r.a.createElement(x.Provider,{value:{user:n,dispatch:o}},e.children)},B=function(e){var t=Object(n.useState)(""),a=Object(l.a)(t,2),o=a[0],s=a[1],c=Object(n.useState)(""),u=Object(l.a)(c,2),i=u[0],d=u[1],m=Object(n.useContext)(E).dispatch,p=Object(n.useContext)(x).user;return r.a.createElement(r.a.Fragment,null,p.username&&r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),m({type:"addBook",book:{title:o,author:i||Date().substr(0,24),id:Date.now()}}),s(""),d("")}},r.a.createElement("input",{placeholder:"title",type:"text",value:o,onChange:function(e){s(e.currentTarget.value)},required:!0}),r.a.createElement("input",{placeholder:"author",type:"text",value:i,onChange:function(e){d(e.currentTarget.value)}}),r.a.createElement("input",{type:"submit",value:"Add Book"})))},S=function(e){var t=e.book;Object(n.useEffect)((function(){a.current.onmouseenter=function(e){e.currentTarget.parentNode.style="opacity:0.7;  text-decoration: line-through;"},a.current.onmouseleave=function(e){e.currentTarget.parentNode.style="opacity:1;  text-decoration: none;"}}),[]);var a=Object(n.useRef)(),o=Object(n.useContext)(E).dispatch;return r.a.createElement("li",null,r.a.createElement("button",{className:"deleteBtn",ref:a,onClick:function(){o({type:"deleteBook",id:t.id})}},"delete"),r.a.createElement("div",{className:"title"},t.title,"  "),r.a.createElement("div",{className:"author"},t.author," "))},T=function(e){var t=Object(n.useContext)(E),a=t.bookList,o=t.dispatch;return Object(n.useEffect)((function(){o({type:"getBookList"})}),[]),r.a.createElement("div",{className:"book-list"},r.a.createElement(B,null),r.a.createElement("ul",null,a.map((function(e){return r.a.createElement(S,{key:e.id,book:e})}))))},N=a(11),L=function(e){var t=Object(n.useContext)(E),a=t.bookList,o=t.dispatch,s=Object(n.useContext)(x),c=s.user,l=s.dispatch;return console.log(Boolean(c.username)),r.a.createElement(r.a.Fragment,null,r.a.createElement("nav",{className:"navbar"},r.a.createElement("h1",null,c.username," Reading List..."),r.a.createElement("p",null,"Currently you have ",a.length," books to get through...")),r.a.createElement("button",null," ",r.a.createElement(N.b,{to:"/"},"home ")," "),!c.username&&r.a.createElement("button",null,"  ",r.a.createElement(N.b,{to:"/login"},"login  ")),!c.username&&r.a.createElement("button",null,"  ",r.a.createElement(N.b,{to:"/register"},"register  ")),c.username&&r.a.createElement("button",{style:{float:"right"},onClick:function(){o({type:"logout"}),l({type:"removeLocalStorage"}),window.location.assign("/")}},"logout"),Boolean(a.length)?r.a.createElement("p",null):r.a.createElement("p",{style:{textAlign:"center"}},"No books to read, Hello free time :)"))},P=a(14),R=a(15),D=a.n(R),F=function(e){var t=e.isRegisterForm,a=Object(n.useContext)(x),o=(a.user,a.dispatch),s=Object(n.useState)({format:t?["text","password","password"]:["text","password"],data:t?{username:"",password:"",password2:""}:{username:"",password:""},error:t?{username:"",password:"",password2:""}:{username:"",password:""}}),c=Object(l.a)(s,2),i=c[0],d=c[1],m=function(e,t){d(Object(O.a)({},i,{error:Object(O.a)({},i.error,Object(P.a)({},e,t))}))},p=Object(n.useRef)(),b={username:D.a.string().min(3).required().label("Username"),password:D.a.string().min(3).required().label("Password"),password2:D.a.any().valid(i.data.password).required().options({language:{any:{allowOnly:"is not matching"}}}).label("Retyped Passwrod")},f=function(e){i.data[e.currentTarget.name]=e.currentTarget.value,i.error=g(e)?Object(O.a)({},i.error,Object(P.a)({},e.currentTarget.name,g(e))):(delete i.error[e.currentTarget.name],i.error),t&&"password"===e.currentTarget.name&&(i.error.password||(i.data.password===i.data.password2?delete i.error.password2:i.error.password2="Two passwords are not matching")),d(Object(O.a)({},i))},g=function(e){var t=D.a.validate(e.currentTarget.value,b[e.currentTarget.name],{abortEarly:!1});return t.error?t.error.details[0].message:null};return r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),o(Object(O.a)({type:t?"register":"login"},i.data,{setErrMsg:m}))}},Object.keys(i.data).map((function(e,t){return r.a.createElement("div",{className:"form-group",key:e},r.a.createElement("label",{htmlFor:e},Object(u.a)(e).shift().toLocaleUpperCase(),e.substr(1)),r.a.createElement("input",{id:e,className:"form-control",type:i.format[t],name:e,value:i.data[e],onChange:f}),r.a.createElement("div",null,i.error[e]))})),r.a.createElement("div",null,r.a.createElement("input",{ref:p,type:"submit",disabled:Boolean(Object.keys(i.error).length),value:t?"Regist":"Login"})))},I=function(e){return r.a.createElement(F,Object.assign({isRegisterForm:!1},e))},q=function(e){return r.a.createElement(F,Object.assign({isRegisterForm:!0},e))};console.log("production");var M=function(e){return r.a.createElement("div",{className:"App"},r.a.createElement(n.Suspense,null),r.a.createElement(C,null,r.a.createElement(j,null,r.a.createElement(L,null),r.a.createElement(c.c,null,r.a.createElement(c.a,{path:"/login",render:function(e){return r.a.createElement(I,e)}}),r.a.createElement(c.a,{path:"/register",render:function(e){return r.a.createElement(q,e)}}),r.a.createElement(T,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(N.a,null,r.a.createElement(M,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[34,1,2]]]);
//# sourceMappingURL=main.da5441e8.chunk.js.map