(this.webpackJsonpninjabook=this.webpackJsonpninjabook||[]).push([[0],{39:function(e,t,n){e.exports=n(84)},44:function(e,t,n){},65:function(e,t,n){e.exports=n.p+"static/media/11.5812c186.jpg"},84:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(19),c=n.n(r),i=(n(44),n(9)),l=n(2),s=n(11),u=n(14),d=n(15),m=n.n(d),f=n(8),p=n.n(f),b="/api";n(64);h()&&(p.a.defaults.headers.common["x-auth-token"]=h());var g=h()?[{title:"... loading ...",author:Date(),id:Date.now()}]:[{title:"Please login to use",author:Date(),id:Date.now()}];function h(){return localStorage.getItem("token")}var E=Object(a.createContext)(),k=function(e){var t=Object(a.useState)(g),n=Object(l.a)(t,2),r=n[0],c=n[1];return o.a.createElement(E.Provider,{value:{bookList:r,dispatch:function(e){return function(e,t,n){var a=n.type,o=void 0===a?"":a,r=Object(u.a)(n,["type"]);if("initialize"===o);else{if("toggleStatus"===o){var c=e.find((function(e){return e.id===r.id}));return c.finish=!c.finish,t(Object(s.a)(e)),console.log(e.find((function(e){return e.id===r.id}))),p.a.put("".concat(b,"/booklist/updatebook/")+r.id,c).then((function(e){})).catch((function(n){var a=e.find((function(e){return e.id===r.id}));a.finish=!a.finish,t(Object(s.a)(e)),console.log(n.response.data),alert(n.response.data)}))}if(h()){if("deleteBook"===o){var i=e.filter((function(e){if(e.id!==r.id)return e}));return p.a.delete("".concat(b,"/booklist/deletebook/")+r.id).then((function(e){setTimeout((function(){t(i)}),500)})).catch((function(n){t(Object(s.a)(e)),console.log(n.response),alert(n.response.data)}))}if("logout"===o)t([]);else{if("cleanFinish"!==o){if("getBookList"===o)return p.a.get(r.justUnfished?"".concat(b,"/booklist/getunfinishedbooklist"):"".concat(b,"/booklist/getbooklist")).then((function(e){var n=e.data.map((function(e){return{title:e.title,author:e.author,id:e.id,finish:e.finish}}));t(n)})).catch((function(e){console.log(e.response.data),alert(e.response.data)}));if("addBook"===o)return t([].concat(Object(s.a)(e),[r.book]).sort((function(e,t){return e.id>=t.id?-1:1}))),p.a.post("".concat(b,"/booklist/addbook"),r.book).then((function(e){})).catch((function(n){t(e),console.log(n.response.data),alert(n.response.data)}));if("uploadFile"===o){t([].concat(Object(s.a)(e),[r.book]).sort((function(e,t){return e.id>=t.id?-1:1})));var l=new FormData;return r.file&&l.append("file",r.file),l.append("obj",JSON.stringify(r.book)),p.a.post("".concat(b,"/booklist/upload"),l,{headers:{"content-type":"multipart/form-data"}}).then((function(e){r.setFile(null),console.log(e.data)})).catch((function(e){console.log(e.response.data),alert(e.response.data)}))}return"downloadFile"===o?p()({url:"".concat(b,"/booklist/download/").concat(String(r.id)),method:"GET",responseType:"blob"}).then((function(e){var t=window.URL.createObjectURL(new Blob([e.data])),n=document.createElement("a");n.href=t,n.setAttribute("download",e.headers["file-name"]),document.body.appendChild(n),n.click()})):e}t(e.filter((function(e){return!0!==e.finish})))}}else console.log("no tokens to perferm booklist functions")}}(r,c,e)}}},e.children)},v=n(10),j=function(){var e=function(){var e=localStorage.getItem("token");return Boolean(e)?m()(e):null}();return e?{username:e.username}:{username:""}}();function O(e){localStorage.setItem("token",e)}var w=Object(a.createContext)(),y=function(e){var t=Object(a.useState)(j),n=Object(l.a)(t,2),r=n[0],c=n[1];return o.a.createElement(w.Provider,{value:{user:r,dispatch:function(e){return function(e,t,n){var a=n.type,o=void 0===a?"":a,r=Object(u.a)(n,["type"]);if("removeLocalStorage"!==o)return"register"===o?p.a.post("".concat(b,"/user/register"),{username:r.username,password:r.password}).then((function(e){O(e.headers["x-auth-token"]),window.location.assign("/")})).catch((function(e){e.response.data.indexOf("user"),r.setErrMsg("username",e.response.data)})):"login"===o?p.a.post("".concat(b,"/user/login"),r).then((function(e){O(e.headers["x-auth-token"]),window.location.assign("/")})).catch((function(e){e.response.data.indexOf("user")>-1?r.setErrMsg("username",e.response.data):r.setErrMsg("password",e.response.data)})):e;localStorage.removeItem("token"),t(Object(v.a)({},e,{username:""}))}(r,c,e)}}},e.children)},x=(n(65),n(33)),C=function(e){var t=Object(a.useState)(""),n=Object(l.a)(t,2),r=n[0],c=n[1],i=Object(a.useState)(""),s=Object(l.a)(i,2),u=s[0],d=s[1],m=Object(a.useState)(null),f=Object(l.a)(m,2),p=f[0],b=f[1],g=Object(a.useContext)(E).dispatch,h=(Object(a.useContext)(w).user,Object(a.createRef)());return o.a.createElement(o.a.Fragment,null,o.a.createElement(x.a,{value:r,placeholder:"title",onChange:function(e){c(e.currentTarget.value)}}),o.a.createElement("input",{placeholder:Date().substr(0,24),type:"text",value:u,onChange:function(e){d(e.currentTarget.value)}}),p&&o.a.createElement("img",{src:p?URL.createObjectURL(p):"",style:{opacity:1,width:200,height:100}}),o.a.createElement("div",null,o.a.createElement("input",{type:"file",style:{display:"none"},onChange:function(e){e.preventDefault(),console.log(e.currentTarget.files[0]),c((r+" "+e.currentTarget.files[0].name).trim()),e.currentTarget.files[0]?b(e.currentTarget.files[0]):b(null)},ref:function(e){return h=e}}),o.a.createElement("button",{className:"btn",onClick:function(){h.click()}},"File"),o.a.createElement("button",{disabled:!r,className:"btn",style:{float:"right",marginTop:"5px"},onClick:function(e){e.preventDefault(),""!==r&&(g({type:"uploadFile",setFile:b,file:p,book:{title:r,author:u||Date().substr(0,24),id:Date.now(),finish:!1}}),c(""),d(""))}},"Add Book")))},S=n(35),T=function(e){var t=e.book,n=(Object(u.a)(e,["book"]),0),r=!1,c=Object(a.useContext)(E).dispatch,i=Object(a.useState)(1),s=Object(l.a)(i,2),d=s[0],m=s[1],f=Object(a.useState)("auto"),p=Object(l.a)(f,2),b=p[0],g=p[1];return o.a.createElement(S.Spring,{from:{opacity:0,height:0},to:{opacity:d,height:b}},(function(e){return o.a.createElement("li",{className:t.finish?"done":"",style:e},o.a.createElement("button",{className:"deleteBtn",onClick:function(){n=setTimeout((function(){r||c({type:"toggleStatus",id:t.id}),r=!1}),200)},onDoubleClick:function(){clearTimeout(n),r=!0,m(0),g(0),c({type:"deleteBook",id:t.id})},onMouseEnter:function(e){e.currentTarget.parentNode.style="opacity:0.7;  text-decoration: line-through;"},onMouseOut:function(e){e.currentTarget.parentNode.style="opacity:1;  text-decoration: none;"}},"delete"),o.a.createElement("div",{className:t.finish?"title done":"title"},t.title,"  "),o.a.createElement("div",{className:t.finish?"author done":"author"},t.author," "),o.a.createElement("button",{className:"btn",style:{background:"#435",color:"#fff"},onClick:function(){c({type:"downloadFile",id:t.id})}},t.id),o.a.createElement("a",{href:"http://localhost/api/booklist/download/".concat(t.id)},t.id))}))},N=function(e){var t=Object(a.useContext)(E),n=t.bookList,r=t.dispatch;return Object(a.useEffect)((function(){setTimeout((function(){r({type:"getBookList",justUnfished:!0})}),0)}),[]),o.a.createElement("div",{className:"book-list "},o.a.createElement(C,null),o.a.createElement("ul",null,n.map((function(t){return o.a.createElement(T,Object.assign({style:e},{key:t.id,book:t}))}))))},F=n(12),B=n(36),L=n.n(B),D=function(e){var t=Object(a.useContext)(E),n=t.bookList,r=t.dispatch,c=Object(a.useContext)(w),i=c.user,s=c.dispatch,u=Object(a.useState)(!1),d=Object(l.a)(u,2),m=d[0],f=d[1];return o.a.createElement(o.a.Fragment,null,o.a.createElement("nav",{className:"navbar",style:e},o.a.createElement("h1",null,i.username," Reading List..."),o.a.createElement("p",null,"Currently you have ",n.length," books to get through..."),o.a.createElement(L.a,{checked:m,onChange:function(){r(m?{type:"cleanFinish"}:{type:"getBookList"}),f(!m)},onColor:"#6d3d6d",offColor:"#6d3d6d",offHandleColor:"#eeeeee",onHandleColor:"#eeeeee",handleDiameter:30,uncheckedIcon:!1,checkedIcon:!1,boxShadow:"0px 1px 5px rgba(0, 0, 0, 0.6)",activeBoxShadow:"0px 0px 1px 10px rgba(0, 0, 0, 0.2)",height:1,width:48,className:"react-switch",id:"material-switch"})),o.a.createElement("button",null," ",o.a.createElement(F.b,{to:"/"},"home ")," "),!i.username&&o.a.createElement("button",null,"  ",o.a.createElement(F.b,{to:"/login"},"login  ")),!i.username&&o.a.createElement("button",null,"  ",o.a.createElement(F.b,{to:"/register"},"register  ")),i.username&&o.a.createElement("button",{style:{float:"right"},onClick:function(){r({type:"logout"}),s({type:"removeLocalStorage"}),window.location.assign("/")}},"logout"),Boolean(n.length)?o.a.createElement("p",null):o.a.createElement("p",{style:{textAlign:"center"}},"No books to read, Hello free time :)"))},R=n(16),U=n(17),I=n.n(U),M=function(e){var t=e.isRegisterForm,n=Object(a.useContext)(w),r=n.user,c=n.dispatch;r.username&&e.history.push("/");var i=Object(a.useState)({format:t?["text","password","password"]:["text","password"],data:t?{username:"",password:"",password2:""}:{username:"",password:""},error:t?{username:"",password:"",password2:""}:{username:"",password:""}}),u=Object(l.a)(i,2),d=u[0],m=u[1],f=function(e,t){m(Object(v.a)({},d,{error:Object(v.a)({},d.error,Object(R.a)({},e,t))}))},p=Object(a.useRef)(),b={username:I.a.string().min(3).required().label("Username"),password:I.a.string().min(3).required().label("Password"),password2:I.a.any().valid(d.data.password).required().options({language:{any:{allowOnly:"is not matching"}}}).label("Retyped Passwrod")},g=function(e){d.data[e.currentTarget.name]=e.currentTarget.value,d.error=h(e)?Object(v.a)({},d.error,Object(R.a)({},e.currentTarget.name,h(e))):(delete d.error[e.currentTarget.name],d.error),t&&"password"===e.currentTarget.name&&(d.error.password||(d.data.password===d.data.password2?delete d.error.password2:d.error.password2="Two passwords are not matching")),m(Object(v.a)({},d))},h=function(e){var t=I.a.validate(e.currentTarget.value,b[e.currentTarget.name],{abortEarly:!1});return t.error?t.error.details[0].message:null};return o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),c(Object(v.a)({type:t?"register":"login"},d.data,{setErrMsg:f}))}},Object.keys(d.data).map((function(e,t){return o.a.createElement("div",{className:"form-group",key:e},o.a.createElement("label",{htmlFor:e},Object(s.a)(e).shift().toLocaleUpperCase(),e.substr(1)),o.a.createElement("input",{id:e,className:"form-control",type:d.format[t],name:e,value:d.data[e],onChange:g}),o.a.createElement("div",null,d.error[e]))})),o.a.createElement("div",null,o.a.createElement("input",{ref:p,type:"submit",disabled:Boolean(Object.keys(d.error).length),value:t?"Regist":"Login"})))},P=function(e){return o.a.createElement(M,Object.assign({isRegisterForm:!1},e))},A=function(e){return o.a.createElement(M,Object.assign({isRegisterForm:!0},e))};console.log("production");var q=function(e){return o.a.createElement("div",{className:"App"},o.a.createElement(a.Suspense,null),o.a.createElement(y,null,o.a.createElement(k,null,o.a.createElement(D,null),o.a.createElement(i.c,null,o.a.createElement(i.a,{path:"/login",render:function(e){return o.a.createElement(P,e)}}),o.a.createElement(i.a,{path:"/register",render:function(e){return o.a.createElement(A,e)}}),o.a.createElement(N,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(F.a,null,o.a.createElement(q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[39,1,2]]]);
//# sourceMappingURL=main.6a1a436f.chunk.js.map