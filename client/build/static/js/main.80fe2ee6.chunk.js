(this.webpackJsonpninjabook=this.webpackJsonpninjabook||[]).push([[0],{40:function(e,t,a){e.exports=a(84)},45:function(e,t,a){},84:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(22),i=a.n(r),c=(a(45),a(15)),l=a(2),s=a(4),u=a(11),d=a(17),p=a.n(d),f=a(5),g=a.n(f),m="/api",b=(a(65),a(10));j()&&(g.a.defaults.headers.common["x-auth-token"]=j());var h=j()?[{title:"... loading ...",author:Date(),id:Date.now()}]:[{title:o.a.createElement(o.a.Fragment,null,"Please ",o.a.createElement(b.b,{to:"/login",style:{color:"#eee"}}," Login ")," or ",o.a.createElement(b.b,{to:"/register",style:{color:"#eee"}}," Regist "),"  to use"),author:Date(),id:Date.now()}];function j(){return localStorage.getItem("token")}var k=Object(n.createContext)(),E=function(e){var t=Object(n.useState)(h),a=Object(l.a)(t,2),r=a[0],i=a[1];return o.a.createElement(k.Provider,{value:{bookList:r,dispatch:function(e){return function(e,t,a){var n=a.type,o=void 0===n?"":n,r=Object(u.a)(a,["type"]);if("initialize"===o);else{if("toggleStatus"===o){var i=e.find((function(e){return e.id===r.id}));return i.finish=!i.finish,t(Object(s.a)(e)),console.log(e.find((function(e){return e.id===r.id}))),g.a.put("".concat(m,"/booklist/updatebook/")+r.id,i).then((function(e){})).catch((function(a){var n=e.find((function(e){return e.id===r.id}));n.finish=!n.finish,t(Object(s.a)(e)),console.log(a.response.data),alert(a.response.data)}))}if(j()){if("deleteBook"===o){var c=e.filter((function(e){if(e.id!==r.id)return e}));return g.a.delete("".concat(m,"/booklist/deletebook/")+r.id).then((function(e){setTimeout((function(){t(c)}),500)})).catch((function(a){t(Object(s.a)(e)),console.log(a.response),alert(a.response.data)}))}if("logout"===o)t([]);else if("cleanFinish"===o)t(e.filter((function(e){return!0!==e.finish})));else{if("getBookList"===o)return g.a.get(r.justUnfished?"".concat(m,"/booklist/getunfinishedbooklist"):"".concat(m,"/booklist/getbooklist")).then((function(e){var a=e.data.map((function(e){return console.log(e),{title:e.title,author:e.author,id:e.id,finish:e.finish,files:e.files,picture:e.picture}}));t(a)})).catch((function(e){console.log(e.response.data),alert(e.response.data)}));if("addBook"===o)return t([].concat(Object(s.a)(e),[r.book]).sort((function(e,t){return e.id>=t.id?-1:1}))),g.a.post("".concat(m,"/booklist/addbook"),r.book).then((function(e){})).catch((function(a){t(e),console.log(a.response.data),alert(a.response.data)}));if("uploadBoth"!==o){if("uploadPic"===o){console.log(r.pic);var l=new FormData;return r.pic.forEach((function(e){l.append("file",e)})),l.append("obj",JSON.stringify(r.book)),g.a.post("".concat(m,"/booklist/uploadpic"),l,{headers:{"content-type":"multipart/form-data"},onUploadProgress:function(e){var t=Math.floor(100*e.loaded/e.total);r.setPicProgress((100*e.loaded/e.total).toFixed(2)+"%"),(100*e.loaded/e.total).toFixed(2)+"%"==="100.00%"&&(r.setPicProgress("Processing on server"),r.setPic(null)),console.log(t)}}).then((function(a){t([].concat(Object(s.a)(e),[r.book]).sort((function(e,t){return e.id>=t.id?-1:1}))),r.setPicProgress("Picture")})).catch((function(e){console.log(e.response.data),alert(e.response.data)}))}if("uploadFile"===o){var d=new FormData;return r.file&&d.append("file",r.file),d.append("obj",JSON.stringify(r.book)),g.a.post("".concat(m,"/booklist/upload"),d,{headers:{"content-type":"multipart/form-data"},onUploadProgress:function(e){var t=Math.floor(100*e.loaded/e.total);r.setFileProgress((100*e.loaded/e.total).toFixed(2)+"%"),(100*e.loaded/e.total).toFixed(2)+"%"==="100.00%"&&(r.setFileProgress("Processing on server"),r.setFile(null)),console.log(t)}}).then((function(a){t([].concat(Object(s.a)(e),[r.book]).sort((function(e,t){return e.id>=t.id?-1:1}))),r.setFileProgress("File")})).catch((function(e){console.log(e.response.data),alert(e.response.data)}))}return"downloadFile"===o?g()({url:"".concat(m,"/booklist/download/").concat(String(r.id)),method:"GET",responseType:"blob",onDownloadProgress:function(e){r.obj((100*e.loaded/e.total).toFixed(2)+"%"),console.log((100*e.loaded/e.total).toFixed(2))}}).then((function(e){var t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",decodeURIComponent(e.headers["file-name"])),document.body.appendChild(a),a.click()})).catch((function(e){console.log(e.response.data),alert(e.response.data)})):"downloadPic"===o?(console.log(r.id),g()({url:"".concat(m,"/booklist/downloadpic/").concat(String(r.id)),method:"GET",responseType:"arraybuffer"}).then((function(e){var t=btoa(new Uint8Array(e.data).reduce((function(e,t){return e+String.fromCharCode(t)}),""));r.setPicture("data:"+e.headers["content-type"]+";base64,"+t)})).catch((function(e){}))):e}var p=new FormData;r.pic.forEach((function(e){p.append("file",e)})),p.append("obj",JSON.stringify(r.book));var f=g.a.post("".concat(m,"/booklist/uploadpic"),p,{headers:{"content-type":"multipart/form-data"},onUploadProgress:function(e){var t=Math.floor(100*e.loaded/e.total);r.setPicProgress((100*e.loaded/e.total).toFixed(2)+"%"),(100*e.loaded/e.total).toFixed(2)+"%"==="100.00%"&&(r.setPicProgress("Processing on server"),r.setPic(null)),console.log(t)}}).then((function(e){r.setPicProgress("Picture")})).catch((function(e){console.log(e.response.data),alert(e.response.data)})),b=new FormData;b.append("file",r.file),b.append("obj",JSON.stringify(r.book));var h=g.a.post("".concat(m,"/booklist/upload"),b,{headers:{"content-type":"multipart/form-data"},onUploadProgress:function(e){var t=Math.floor(100*e.loaded/e.total);r.setFileProgress((100*e.loaded/e.total).toFixed(2)+"%"),(100*e.loaded/e.total).toFixed(2)+"%"==="100.00%"&&(r.setFileProgress("Processing on server"),r.setFile(null)),console.log(t)}}).then((function(e){r.setFileProgress("File")})).catch((function(e){console.log(e.response.data),alert(e.response.data)}));Promise.all([f,h]).then((function(){t([].concat(Object(s.a)(e),[r.book]).sort((function(e,t){return e.id>=t.id?-1:1})))})).catch((function(e){console.log(e),alert(e)}))}}else console.log("no tokens to perferm booklist functions")}}(r,i,e)}}},e.children)},O=a(12),v=function(){var e=function(){var e=localStorage.getItem("token");return Boolean(e)?p()(e):null}();return e?{username:e.username}:{username:""}}();function y(e){localStorage.setItem("token",e)}var w=Object(n.createContext)(),x=function(e){var t=Object(n.useState)(v),a=Object(l.a)(t,2),r=a[0],i=a[1];return o.a.createElement(w.Provider,{value:{user:r,dispatch:function(e){return function(e,t,a){var n=a.type,o=void 0===n?"":n,r=Object(u.a)(a,["type"]);if("removeLocalStorage"!==o)return"register"===o?g.a.post("".concat(m,"/user/register"),{username:r.username,password:r.password}).then((function(e){y(e.headers["x-auth-token"]),window.location.assign("/")})).catch((function(e){e.response.data.indexOf("user"),r.setErrMsg("username",e.response.data)})):"login"===o?g.a.post("".concat(m,"/user/login"),r).then((function(e){y(e.headers["x-auth-token"]),window.location.assign("/")})).catch((function(e){e.response.data.indexOf("user")>-1?r.setErrMsg("username",e.response.data):r.setErrMsg("password",e.response.data)})):e;localStorage.removeItem("token"),t(Object(O.a)({},e,{username:""}))}(r,i,e)}}},e.children)},P=a(38),F=function(e){var t,a=Object(n.useState)(""),r=Object(l.a)(a,2),i=r[0],c=r[1],s=Object(n.useState)(""),u=Object(l.a)(s,2),d=u[0],p=u[1],f=Object(n.useState)(null),g=Object(l.a)(f,2),m=g[0],b=g[1],h=Object(n.useState)(null),j=Object(l.a)(h,2),E=j[0],O=j[1],v=Object(n.useState)("File"),y=Object(l.a)(v,2),x=y[0],F=y[1],C=Object(n.useState)("Picture"),S=Object(l.a)(C,2),T=S[0],D=S[1],N=Object(n.useContext)(k).dispatch,L=(Object(n.useContext)(w).user,Object(n.createRef)());return o.a.createElement(o.a.Fragment,null,o.a.createElement(P.a,{value:i,placeholder:"title",onChange:function(e){c(e.currentTarget.value)}}),o.a.createElement("input",{placeholder:Date().substr(0,24),type:"text",value:d,onChange:function(e){p(e.currentTarget.value)}}),E&&E.map((function(e,t){return o.a.createElement("img",{key:t,src:e?URL.createObjectURL(e):"",style:{opacity:1,width:200,height:"auto"}})})),m&&o.a.createElement("div",null,m.name),o.a.createElement("div",null,o.a.createElement("input",{type:"file",multiple:!0,style:{display:"none"},accept:"image/x-png,image/gif,image/jpeg",onChange:function(e){if(e.preventDefault(),console.log(e.currentTarget.files),!e.currentTarget.files[0])return O(null);for(var t=[],a=0;a<e.currentTarget.files.length;a++)t.push(e.currentTarget.files[a]);e.currentTarget.files?O(t):O(null)},ref:function(e){return t=e}}),o.a.createElement("button",{disabled:"File"!==x||"Picture"!==T,className:"btn",onClick:function(){t.click()}},T),o.a.createElement("input",{type:"file",style:{display:"none"},onChange:function(e){if(e.preventDefault(),console.log(e.currentTarget.files[0]),!e.currentTarget.files[0])return b(null);c((i+" "+e.currentTarget.files[0].name).trim()),e.currentTarget.files[0]?b(e.currentTarget.files[0]):b(null)},ref:function(e){return L=e}}),o.a.createElement("button",{disabled:"File"!==x||"Picture"!==T,className:"btn",onClick:function(){L.click()}},x),o.a.createElement("button",{disabled:!i||"File"!==x,className:"btn",style:{float:"right",marginTop:"5px"},onClick:function(e){if(e.preventDefault(),""===i)return null;!m&&!E&&N({type:"addBook",book:{title:i,author:d||Date().substr(0,24),id:Date.now(),finish:!1}}),m&&!E&&N({type:"uploadFile",setFileProgress:F,setFile:b,file:m,pic:E,book:{title:i,files:[m.name],author:d||Date().substr(0,24),id:Date.now(),finish:!1}}),!m&&E&&N({type:"uploadPic",setPicProgress:D,setPic:O,pic:E,book:{title:i,picture:!0,author:d||Date().substr(0,24),id:Date.now(),finish:!1}}),m&&E&&N({type:"uploadBoth",setFileProgress:F,setPicProgress:D,setFile:b,setPic:O,file:m,pic:E,book:{title:i,picture:!0,files:[m.name],author:d||Date().substr(0,24),id:Date.now(),finish:!1}}),c(""),p("")}},"Add Book")))},C=a(18),S=a(19),T=function(e){var t=e.whenClick,a=Object(u.a)(e,["whenClick"]),r=Object(n.useState)("0%"),i=Object(l.a)(r,2),c=i[0],s=i[1],d=Object(n.useState)(!1),p=Object(l.a)(d,2),f=p[0],g=p[1],m=Object(S.b)({from:{width:"0%"},margin:"0",width:c,paddingLeft:"10px",padding:"0",background:"linear-gradient(to right, #4880EC, #019CAD)",whiteSpace:"nowrap",borderRadius:"4px"});return o.a.createElement(o.a.Fragment,null,o.a.createElement("button",Object.assign({disabled:f,style:{padding:"0",border:"0"},onClick:function(){g(!0),t(s)}},a),o.a.createElement(S.a.div,{style:m,onClick:function(){s("5%")}},o.a.createElement("div",{style:{paddingLeft:"10px",paddingRight:"10px"}},a.children))))},D=function(e){var t=e.book,a=e.dispatch,n=e.setGoalOpa,r=e.setGoalHeight,i=Object(u.a)(e,["book","dispatch","setGoalOpa","setGoalHeight"]),c=0,l=!1;return o.a.createElement(o.a.Fragment,null,o.a.createElement("button",{className:"deleteBtn",onClick:function(){c=setTimeout((function(){l||a({type:"toggleStatus",id:t.id}),l=!1}),200)},onDoubleClick:function(){clearTimeout(c),l=!0,n(0),r(0),a({type:"deleteBook",id:t.id})},onMouseEnter:function(e){e.currentTarget.parentNode.style="opacity:0.7;  text-decoration: line-through;  padding-left:10px"},onMouseOut:function(e){e.currentTarget.parentNode.style="opacity:1;  text-decoration: none;  padding-left:10px"}},i.children))},N=function(e){var t=e.book,a=(Object(u.a)(e,["book"]),Object(n.useContext)(k).dispatch),r=Object(n.useContext)(w).user,i=Object(n.useState)(1),c=Object(l.a)(i,2),s=c[0],d=c[1],p=Object(n.useState)("auto"),f=Object(l.a)(p,2),g=f[0],m=f[1],b=Object(n.useState)(null),h=Object(l.a)(b,2),j=h[0],E=h[1],v=Object(n.useState)(20),y=Object(l.a)(v,2),x=y[0],P=y[1];return Object(n.useLayoutEffect)((function(){t.picture&&a({type:"downloadPic",id:t.id,setPicture:E})}),[]),o.a.createElement(o.a.Fragment,null,o.a.createElement(C.Spring,{from:{opacity:0,height:0},to:{opacity:s,height:g},config:{delay:0,duration:200,friction:10}},(function(e){return o.a.createElement("li",{style:e},o.a.createElement("div",{style:{height:"5px",opacity:"0"}}),o.a.createElement("div",{className:t.finish?"done":"",style:{paddingLeft:"10px",paddingRight:"0px"}},r.username?o.a.createElement(D,{setGoalOpa:d,setGoalHeight:m,dispatch:a,book:t,props:e},"  delete  "):o.a.createElement("div",null),o.a.createElement("span",{className:t.finish?"title done":"title",style:{boxShadow:"none"}},t.title,"  "),t.picture&&o.a.createElement("div",{style:{paddingRight:"10px"}},o.a.createElement(C.Spring,{from:{opacity:0,width:"0%"},to:{opacity:1,width:x+"%"},config:{duration:200}},(function(e){return o.a.createElement("img",{src:j,style:Object(O.a)({},e,{borderRadius:"4px"}),onClick:function(){P(20===x?100:20)}})}))),o.a.createElement("div",{className:t.finish?"author done":"author"},t.author," "),t.files&&o.a.createElement(T,{whenClick:function(e){a({type:"downloadFile",id:t.id,obj:e})},className:"btn bar"},t.files[0])),o.a.createElement("div",{style:{height:"5px",opacity:"0"}}))})))},L=function(e){var t=Object(n.useContext)(k),a=t.bookList,r=t.dispatch,i=Object(n.useContext)(w).user;return Object(n.useEffect)((function(){setTimeout((function(){r({type:"getBookList",justUnfished:!0})}),0)}),[]),o.a.createElement("div",{className:"book-list "},i.username&&o.a.createElement(F,null),o.a.createElement("ul",null,a.map((function(t){return o.a.createElement(N,Object.assign({style:e},{key:t.id,book:t}))}))))},B=a(39),R=a.n(B),U=function(e){var t=Object(n.useContext)(k),a=t.bookList,r=t.dispatch,i=Object(n.useContext)(w),c=i.user,s=i.dispatch,u=Object(n.useState)(!1),d=Object(l.a)(u,2),p=d[0],f=d[1];return document.title=c.username||"NinjaBook",o.a.createElement(o.a.Fragment,null,o.a.createElement("nav",{className:"navbar"},o.a.createElement("h1",null,c.username," Reading List..."),o.a.createElement("p",null,"Currently you have ",a.length," books to get through..."),o.a.createElement(R.a,{checked:p,onChange:function(){r(p?{type:"cleanFinish"}:{type:"getBookList"}),f(!p)},onColor:"#6d3d6d",offColor:"#6d3d6d",offHandleColor:"#eeeeee",onHandleColor:"#eeeeee",handleDiameter:30,uncheckedIcon:!1,checkedIcon:!1,boxShadow:"0px 1px 5px rgba(0, 0, 0, 0.6)",activeBoxShadow:"0px 0px 1px 10px rgba(0, 0, 0, 0.2)",height:1,width:48,className:"react-switch",id:"material-switch"})),o.a.createElement("button",null," ",o.a.createElement(b.b,{to:"/"},"home ")," "),!c.username&&o.a.createElement("button",null,"  ",o.a.createElement(b.b,{to:"/login"},"login  ")),!c.username&&o.a.createElement("button",null,"  ",o.a.createElement(b.b,{to:"/register"},"register  ")),c.username&&o.a.createElement("button",{style:{float:"right"},onClick:function(){r({type:"logout"}),s({type:"removeLocalStorage"}),window.location.assign("/")}},"logout"),Boolean(a.length)||o.a.createElement("p",{style:{textAlign:"center"}},"No books to read, Hello free time :)"))},M=a(13),G=a(20),I=a.n(G),A=function(e){var t=e.isRegisterForm,a=Object(n.useContext)(w),r=a.user,i=a.dispatch;r.username&&e.history.push("/");var c=Object(n.useState)({format:t?["text","password","password"]:["text","password"],data:t?{username:"",password:"",password2:""}:{username:"",password:""},error:t?{username:"",password:"",password2:""}:{username:"",password:""}}),u=Object(l.a)(c,2),d=u[0],p=u[1],f=function(e,t){p(Object(O.a)({},d,{error:Object(O.a)({},d.error,Object(M.a)({},e,t))}))},g=Object(n.useRef)(),m={username:I.a.string().min(3).required().label("Username"),password:I.a.string().min(3).required().label("Password"),password2:I.a.any().valid(d.data.password).required().options({language:{any:{allowOnly:"is not matching"}}}).label("Retyped Passwrod")},b=function(e){d.data[e.currentTarget.name]=e.currentTarget.value,d.error=h(e)?Object(O.a)({},d.error,Object(M.a)({},e.currentTarget.name,h(e))):(delete d.error[e.currentTarget.name],d.error),t&&"password"===e.currentTarget.name&&(d.error.password||(d.data.password===d.data.password2?delete d.error.password2:d.error.password2="Two passwords are not matching")),p(Object(O.a)({},d))},h=function(e){var t=I.a.validate(e.currentTarget.value,m[e.currentTarget.name],{abortEarly:!1});return t.error?t.error.details[0].message:null};return o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),i(Object(O.a)({type:t?"register":"login"},d.data,{setErrMsg:f}))}},Object.keys(d.data).map((function(e,t){return o.a.createElement("div",{className:"form-group",key:e},o.a.createElement("label",{htmlFor:e},Object(s.a)(e).shift().toLocaleUpperCase(),e.substr(1)),o.a.createElement("input",{id:e,className:"form-control",type:d.format[t],name:e,value:d.data[e],onChange:b}),o.a.createElement("div",null,d.error[e]))})),o.a.createElement("div",null,o.a.createElement("input",{ref:g,type:"submit",disabled:Boolean(Object.keys(d.error).length),value:t?"Regist":"Login"})))},H=function(e){return o.a.createElement(A,Object.assign({isRegisterForm:!1},e))},J=function(e){return o.a.createElement(A,Object.assign({isRegisterForm:!0},e))};console.log("production");var q=function(e){return o.a.createElement("div",{className:"App"},o.a.createElement(x,null,o.a.createElement(E,null,o.a.createElement(U,null),o.a.createElement(c.c,null,o.a.createElement(c.a,{path:"/login",render:function(e){return o.a.createElement(H,e)}}),o.a.createElement(c.a,{path:"/register",render:function(e){return o.a.createElement(J,e)}}),o.a.createElement(L,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(b.a,null,o.a.createElement(q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[40,1,2]]]);
//# sourceMappingURL=main.80fe2ee6.chunk.js.map